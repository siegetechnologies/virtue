<source>
  @type secure_forward
  shared_key fluentd
  secure true
  self_hostname server.fqdn.local #autogenerated default
  ca_cert_path /etc/fluent/ca_cert.pem
  ca_private_key_path /etc/fluent/ca_key.pem
  ca_private_key_passphrase {{fluent_ca_pass}}
  port 24224
  bind 0.0.0.0
</source>

<source>
  @type forward
  port 5170
  bind 0.0.0.0
</source>

# pstail
<source>
	@type exec
	tag pstail
	<parse>
		@type tsv
		keys virtueid,pid,user,name,mem,full
		delimiter " "
	</parse>
	command /etc/fluent/pstail
</source>

<source>
	@type exec
	tag dmesg
	<parse>
		@type tsv
		keys virtueid,dmesg
		delimiter "	"
	</parse>
	command /etc/fluent/dmesgtail
</source>



## match tag=debug.** and dump to console
<match debug.**>
  @type stdout
  @id stdout_output
</match>

#<match maven.**>
#</match>

<match **>
  @type copy_ex
  <store ignore_error>
    @type s3
    aws_key_id {{aws_access_key_id}}
    aws_sec_key {{aws_secret_access_key}}
    s3_bucket {{s3_bucket_prefix}}-fluentd-logs
    s3_region {{ virtue_aws_region }}
    path logs/
    # can use ${tag} or %Y/%m/%d or real ruby code here for path
  </store>
  <store ignore_error>
    @type remote_syslog
    host {{ apl_fsr }}
    port 514
    protocol tcp
    severity debug
    program siege-virtue-fluentd
  </store>
</match>
